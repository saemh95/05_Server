--Create member table
CREATE TABLE "MEMBER" (
	"MEMBER_NO"	NUMBER		NOT NULL,
	"MEMBER_ID"	VARCHAR2(50)		NOT NULL,
	"MEMBER_PW"	VARCHAR2(100)		NOT NULL,
	"MEMBER_NICKNAME" VARCHAR2(30) NOT NULL,
	"ENROLL_DATE"	DATE	DEFAULT SYSDATE NOT NULL,
	"MEMBER_DEL_FL"	CHAR(1)	DEFAULT 'N'	NOT NULL
);
--Comment on Member
COMMENT ON COLUMN "MEMBER"."MEMBER_NO" IS 'Member Number(SEQ_MEMBER_NO)';

COMMENT ON COLUMN "MEMBER"."MEMBER_ID" IS 'Member Id';

COMMENT ON COLUMN "MEMBER"."MEMBER_PW" IS 'Member Password';

COMMENT ON COLUMN "MEMBER"."MEMBER_NAME" IS 'Member name';

COMMENT ON COLUMN "MEMBER"."ENROLL_DATE" IS 'Singup Date';

COMMENT ON COLUMN "MEMBER"."MEMBER_DEL_FL" IS 'Delete Account(N:Not deleted, Y:Deleted)';

ALTER TABLE "MEMBER" RENAME COLUMN "MEMBER_NICKNAME" TO "MEMBER_NAME";

COMMIT;

--Member table add constraints
ALTER TABLE "MEMBER" ADD CONSTRAINT "PK_MEMBER" PRIMARY KEY (
	"MEMBER_NO"
);
ALTER TABLE "MEMBER" ADD CONSTRAINT "CH_MEMBER_DEL_FL" 
CHECK("MEMBER_DEL_FL" IN ('N', 'Y'));

--Add sequence
CREATE SEQUENCE SEQ_MEMBER_NO NOCACHE;
DROP SEQUENCE SEQ_MEMBER_NO;
--Add member
INSERT INTO "MEMBER"
VALUES(SEQ_MEMBER_NO.NEXTVAL, 'user02', 'pass02'
	, 'Squid2', DEFAULT, DEFAULT);

INSERT INTO "MEMBER" VALUES (SEQ_MEMBER_NO.NEXTVAL, ?, ?, ?, DEFAULT, DEFAULT)
	
SELECT * FROM "MEMBER";
DELETE FROM "MEMBER" WHERE MEMBER_NO = 3;

SELECT MEMBER_NO, MEMBER_ID, MEMBER_PW, MEMBER_NAME, TO_CHAR(ENROLL_DATE, 'YYYY"년" MM"월" DD"일" HH"시" MI"분" SS"초"') AS ENROLL_DATE FROM "MEMBER" WHERE MEMBER_ID = 'user01' AND MEMBER_PW = 'pass01';
SELECT MEMBER_NO, MEMBER_ID, MEMBER_PW, MEMBER_NAME, TO_CHAR(ENROLL_DATE, 'YYYY"년" MM"월" DD"일" HH24"시" MI"분" SS"초"') ENROLL_DATE FROM MEMBER WHERE MEMBER_ID = 'user01' AND MEMBER_PW = 'pass01' AND MEMBER_DEL_FL = 'N';

--CREATE TABLE MENU (
--	MENU_PLAY VARCHAR2(20) NOT NULL,
--	MENU_STATS VARCHAR2(50),
--	MENU_HELP  VARCHAR2(100) NOT NULL,
--	MENU_OPTION VARCHAR2(50) NOT NULL,
--	"MEMBER_NO" NUMBER NOT NULL
--);
--COMMENT ON COLUMN MENU.MENU_PLAY IS 'Dificulty';
--COMMENT ON COLUMN MENU.MENU_STATS IS 'User Statistics';
--COMMENT ON COLUMN MENU.MENU_HELP IS 'Instruction of the Game';
--COMMENT ON COLUMN MENU.MENU_OPTION IS 'Options';
--
--ALTER TABLE MENU ADD (
--    MENU_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
--    CONSTRAINT PK_MENU PRIMARY KEY (MENU_ID)
--);
--
--ALTER TABLE MENU ADD CONSTRAINT "FK_MEMBER_TO_MENU" FOREIGN KEY (MEMBER_NO) REFERENCES "MEMBER" (MEMBER_NO);
--SELECT * FROM MENU WHERE MEMBER_ID = 1;
--SELECT * FROM MENU;
--
--CREATE SEQUENCE SEQ_MENU_ID NOCACHE;
--INSERT INTO MENU
--VALUES('EASY', '1', 'help menu'
--	, 'option 1', 1, SEQ_MENU_ID.NEXTVAL);
--	
--DELETE FROM MENU WHERE MEMBER_NO = 1;
--VALUES('MEDIUM', '1', 'help menu'
--	, 'option 1', 1, SEQ_MENU_ID.NEXTVAL);
--	
--DROP TABLE MENU;

COMMIT;

 CREATE TABLE GAMES (
    GAME_ID NUMBER,
    MEMBER_ID NUMBER,
    START_TIME TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    END_TIME TIMESTAMP,
    DIFFICULTY VARCHAR2(10),
    STATUS VARCHAR2(15)
);
CREATE SEQUENCE SEQ_GAME_ID NOCACHE;
SELECT * FROM GAMES;
INSERT INTO GAMES VALUES (SEQ_GAME_ID.NEXTVAL, 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, 'EASY', 'Y');
ALTER TABLE GAMES ADD CONSTRAINT "PK_GAMES_ID" PRIMARY KEY (
	"GAME_ID"
);
ALTER TABLE GAMES RENAME COLUMN "MEMBER_ID" TO "MEMBER_NO";
ALTER TABLE GAMES ADD CONSTRAINT "FK_MEMBER_TO_GAMES" FOREIGN KEY (
	"MEMBER_NO"
)
REFERENCES "MEMBER" (
	"MEMBER_NO"
);

SELECT * FROM GAMES;

CREATE TABLE GAME_STATE (
    GAME_STATE_ID NUMBER,
    GAME_ID NUMBER,
    CELL_POSITION VARCHAR2(5),
    VALUE NUMBER DEFAULT 0,
    INITIAL_VALUE NUMBER(1),
    CONSTRAINT PK_GAME_STATE PRIMARY KEY (GAME_STATE_ID),
    CONSTRAINT FK_GAME_TO_GAME_STATE FOREIGN KEY (GAME_ID) REFERENCES Games(GAME_ID)
);
INSERT INTO GAME_STATE VALUES (1, 1, NULL, DEFAULT, 0);
ALTER TABLE GAME_STATE ADD CONSTRAINT 
CREATE SEQUENCE GAME_STATE_SEQ
START WITH 1
INCREMENT BY 1
NOCACHE;

CREATE TABLE MENU_LIST (
	MENU_NAME VARCHAR2(30) NOT NULL,
	MENU_LINK VARCHAR2(30) NOT NULL,
	MEMBER_NO NUMBER
);
ALTER TABLE MENU_LIST ADD CONSTRAINT "PK_MENU_NAME" PRIMARY KEY (MENU_NAME);
ALTER TABLE MENU_LIST ADD CONSTRAINT "FK_MEMBER_TO_MENU" FOREIGN KEY (MEMBER_NO) REFERENCES "MEMBER" (MEMBER_NO);

SELECT * FROM MENU_LIST;
--ALTER TABLE MENU_LIST DROP COLUMN MEMBER_NO;
INSERT INTO MENU_LIST VALUES ('PLAY','/play');
INSERT INTO MENU_LIST VALUES ('STATS','/stats');
INSERT INTO MENU_LIST VALUES ('HELP','/help');
INSERT INTO MENU_LIST VALUES ('OPTIONS','/options');

CREATE TABLE STATS (
	MEMBER_NO NUMBER,
	GAMES_ID NUMBER,
	GAMES_PLAYED NUMBER,
	SHORTEST TIMESTAMP,
	LONGEST TIMESTAMP
);

INSERT INTO STATS VALUES (1, NULL, NULL, NULL, NULL);
INSERT INTO STATS VALUES (1, 1, 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);
INSERT INTO STATS (MEMBER_NO, GAME_STATE_ID, GAMES_PLAYED, SHORTEST, LONGEST) VALUES (1, 1, 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

SELECT * FROM STATS;
SELECT MEMBER_NO, GAMES_PLAYED, SHORTEST, LONGEST FROM STATS WHERE MEMBER_NO = 1;

ALTER TABLE STATS RENAME COLUMN GAMES_ID TO GAME_ID;
ALTER TABLE STATS RENAME COLUMN GAME_ID TO GAME_STATE_ID;
ALTER TABLE STATS ADD CONSTRAINT "FK_MEMBER_TO_STATS" FOREIGN KEY (MEMBER_NO) REFERENCES "MEMBER" (MEMBER_NO);
ALTER TABLE STATS ADD CONSTRAINT "FK_GAMES_TO_STATS" FOREIGN KEY (GAME_STATE_ID) REFERENCES GAME_STATE (GAME_STATE_ID);

CREATE TABLE DIFFICULTY (
	DIFFICULTY_NAME VARCHAR2(30) NOT NULL,
	DIFFICULTY_LINK VARCHAR2(30) NOT NULL
);

INSERT INTO DIFFICULTY VALUES ('EASY', '/play/easy');
INSERT INTO DIFFICULTY VALUES ('MEDIUM', '/play/medium');
INSERT INTO DIFFICULTY VALUES ('HARD', '/play/hard');
--ALTER TABLE DIFFICULTY DROP COLUMN MEMBER_NO;
COMMIT;
DROP TABLE DIFFICULTY;
SELECT DIFFICULTY_NAME, DIFFICULTY_LINK FROM DIFFICULTY;